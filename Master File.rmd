---
title: "Group 27 Project"
author: "Jade Butler, Sonia Saxon, Joanna Mendelsohn, Kai Smith"
date: "`r Sys.Date()`"
output: openintro::lab_report
---

```{r load-packages, message=FALSE}
library(tidyverse)
library(openintro)
library(rmarkdown)
library(BSDA)
library(infer)
library (ggpubr)
library(car)
library(ggplot2)
library(broom)
library(flextable)
```

### Problem 1: Read in and Prepare Data
```{r PR}
Fish <- read.csv("fish.csv")
Fish$Site <- factor(Fish$Site)
Fish$AgeP<- factor(Fish$AgeP)
Fish$YrCaught <- factor(Fish$YrCaught)
Fish$YrTagged <- factor(Fish$YrTagged)
count(Fish) #5345 total observations
Fish2 <- filter(Fish, is.na(YrTagged) | YrCaught == YrTagged) #this is our new data set for the rest of the assignment
count(Fish2) #5306 total observations after filtering out YrCaught > YrTagged
summary(Fish2) #1321 NAs in YrTagged and 2771 NAs in Weight
``` 



### Problem 3: Exploratory Data Analysis
#### Part 3a) EDAs of Weight, Age and Length
```{r Univariate EDA}
h1 <- ggplot(Fish2, aes(x = AgeP)) +
  geom_bar(fill = "cornflowerblue") + 
  labs(x = "Probable Age", 
       title = "Fish Measured Age 0-3 Years") 
summary(Fish2$AgeP)
h2 <- ggplot(data = Fish2, aes(x = Length)) + 
  geom_histogram(binwidth = 2, 
                 fill = "cornflowerblue") + 
  labs(title = "Captured Fish Measured Fork Length in mm", 
       x = "Length in mm") 
summary(Fish2$Length)
h3 <- ggplot(data = Fish2, aes(x = Weight)) +
  geom_histogram(binwidth = 2, 
                 fill = "cornflowerblue") + 
  labs(title = "Captured Fish Measured Weight in Grams", 
       x = "Weight in grams") 
summary(Fish2$Weight)
ggarrange(h1, h2, h3)
```

#### Part 3b) Bivariate EDA of Weight and Length
```{r Bivariate EDA}
s1 <- scatterplot(Fish2$Length, Fish2$Weight, 
            pch = 19,                  
            col = "cornflowerblue",                    
            smooth = FALSE,             
            regLine = FALSE,
            main = "Fish Fork Length on Fish Weight Visualization", xlab = "Fork Length in mm", ylab = "Weight in grams",
            cex.axis = 1.2, cex.lab = 1.2, cex = 1.2)
summary(Fish2$Length, Fish2$Weight)

```

### Problem 4: Regression of Weight on Length
#### Part 4a)
```{r Scatterplot}
s2 <- ggplot(Fish2, aes(x=log(Length), y=log(Weight))) +
  geom_point(color="cornflowerblue", 
             size = 1, 
             alpha=.5) +  
  labs(title = "Natural Log Measured Weight on Measured Fork Length", 
       x = "Natural Log Length in mm", 
       y = "Natural Log Weight in grams")
s2
```



#### Part 4b) Include Linear Regression
```{r Reg W on L}
s3 <- ggplot(Fish2, aes(x=log(Length), y=log(Weight))) +
  geom_point(color="cornflowerblue", 
             size = 1, 
             alpha=.5) +  
  geom_smooth(method = "lm", se = FALSE, color="black") + 
  labs(title = "Natural Log Measured Weight on Natural Log Measured Fork Length", 
       x = "Natural Log Fork Length in mm", 
       y = "Natural Log Weight in grams")
s3
lm1.out <- lm(log(Fish2$Weight) ~ log(Fish2$Length))
  summary(lm1.out)
```
#### Part 4c) Regression Diagnostics
```{r Reg Diagnostics}
par(mfrow = c(2, 2))
plot(Fish2$Weight, Fish2$Length, xlab="Fish Weight (g)", pch=19,
     ylab="Fish 2 Fork Length (mm)", cex.lab=1.25, cex.axis=1.25)

plot(fitted(lm1.out), residuals(lm1.out),
     xlab="Fitted Values", ylab="Residuals") 
abline(h=0, col="blue", lwd=2)

hist(residuals(lm1.out), xlab="Residuals", main = "" )
qqnorm(residuals(lm1.out))
qqline(residuals(lm1.out))
mtext("Regression Diagnostics for Natural Log Model", side = 3, line = -1.5, outer = TRUE)
```


#### Part 4e) Hypothesis Test for the Regression Slope Parameter
```{r C.I }
t.test(log(Fish2$Weight),log(Fish2$Length), conf.level=0.95)
qt(0.975,2533) 
```


#### Part 4f) Confidence Interval for Weight Given Length
```{r CI and PI} 
lm2.out <- lm(log(Weight) ~ log(Length), data=data.frame(Fish2))
new.Length <- data.frame(Length = 70)
(CI.Length70 <- predict(lm2.out, newdata = new.Length, interval = "confidence", level = 0.95))
(PI.Length70 <- predict(lm2.out, newdata = new.Length, interval = "prediction", level = 0.95))

summary(lm2.out)

```


### Problem 5: Fish Length and Site
#### Part 5a) Boxplots of Fish Length by Site
```{r FL by Site}
b1 <- ggplot(Fish2, aes(x = Site, y = Length, fill = Site)) + 
  geom_boxplot() + xlab("Site Location") +
  ylab("Fish Fork Length (mm)") 
b1
```

#### Part 5b) Inferences for Fish Length
```{r Inference for Length}
site1 <- Fish2 %>%
  filter(Site == "Site 1")

site3 <- Fish2 %>%
  filter(Site == "Site 3")

t.test(site1$Length, site3$Length, conf.level = 0.95)$conf.int
```


#### Part 5c) Testing the Claim of Difference in Mean Length
```{r Testing Claim w/ Signif. Level}
summary(site1)
sd(site1$Length)
nrow(site1)

summary(site3)
sd(site3$Length)
nrow(site3)

tsum.test(87.75, 29.37401, 1418, 78.59, 24.01731, 2222)
```